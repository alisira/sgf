<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" dir="ltr" lang="es"><head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="keywords" content="ORM-Hibernate Consultas basadas Hiberante">
<link rel="shortcut icon" href="http://wiki.cetechihuahua.gob.mx/favicon.ico">
<link title="Creative Commons" type="application/rdf+xml" href="http://wiki.cetechihuahua.gob.mx/index.php?title=ORM-Hibernate_Consultas_basadas_Hiberante&amp;action=creativecommons" rel="meta">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
	<title>ORM-Hibernate Consultas basadas Hiberante - CIST</title>
	<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "http://wiki.cetechihuahua.gob.mx/skins/cavendish/main.css"; /*]]>*/</style>
	<link rel="stylesheet" type="text/css" media="print" href="ORM-Hibernate%20Consultas%20basadas%20Hiberante%20-%20CIST_files/commonPrint.css">
	<script type="text/javascript" src="ORM-Hibernate%20Consultas%20basadas%20Hiberante%20-%20CIST_files/index.php"></script>	<script type="text/javascript" src="ORM-Hibernate%20Consultas%20basadas%20Hiberante%20-%20CIST_files/wikibits.js"></script>
	<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Common.css&action=raw&ctype=text/css&smaxage=18000";
@import "/index.php?title=MediaWiki:Cavendish.css&action=raw&ctype=text/css&smaxage=18000";
@import "/index.php?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</style>		</head>

<body class="ns-0">

<div id="internal"></div>
<div id="container">

	<div id="mozilla-org"><a href="http://www.ipbwiki.com/forums/index.php?download=60">Mozilla Skin</a></div>

		<div id="header">
		<a name="top" id="contentTop"></a>
		<h1><a href="http://wiki.cetechihuahua.gob.mx/index.php/Portada" title="Portada">ORM-Hibernate Consultas basadas Hiberante</a></h1>
		<ul>
		   	<li class="selected"><a href="http://wiki.cetechihuahua.gob.mx/index.php/ORM-Hibernate_Consultas_basadas_Hiberante">Artículo</a></li><li class="new"><a href="http://wiki.cetechihuahua.gob.mx/index.php?title=Discusi%C3%B3n:ORM-Hibernate_Consultas_basadas_Hiberante&amp;action=edit">Discusión</a></li><li><a href="http://wiki.cetechihuahua.gob.mx/index.php?title=ORM-Hibernate_Consultas_basadas_Hiberante&amp;action=edit">Editar</a></li><li><a href="http://wiki.cetechihuahua.gob.mx/index.php?title=ORM-Hibernate_Consultas_basadas_Hiberante&amp;action=history">Historial</a></li>		</ul>
		<form name="searchform" action="/index.php/Especial:Search" id="search">
			<div>
			<label for="q">Buscar</label>
			<input id="q" name="search" accesskey="f" type="text">
			<input name="go" class="searchButton" id="searchGoButton" value="Ir" type="submit">&nbsp;<input name="fulltext" class="searchButton" value="Buscar" type="submit">
	       </div>
		</form>
	</div>

	<div id="mBody">
	
		<div id="side">
			<ul id="nav">
				<li><span>Herramientas personales</span>
					<ul>
					<li id="pt-login"><a href="http://wiki.cetechihuahua.gob.mx/index.php?title=Especial:Userlogin&amp;returnto=ORM-Hibernate_Consultas_basadas_Hiberante">Registrarse/Entrar</a></li>					</ul>
				</li>
								<li><span>Navegación</span>
						<ul>
										<li id="n-mainpage"><a href="http://wiki.cetechihuahua.gob.mx/index.php/Portada">Portada</a></li>
										<li id="n-portal"><a href="http://wiki.cetechihuahua.gob.mx/index.php/CIST:Portal_de_la_comunidad">Portal de la comunidad</a></li>
										<li id="n-currentevents"><a href="http://wiki.cetechihuahua.gob.mx/index.php/Actualidad">Actualidad</a></li>
										<li id="n-recentchanges"><a href="http://wiki.cetechihuahua.gob.mx/index.php/Especial:Recentchanges">Cambios recientes</a></li>
										<li id="n-randompage"><a href="http://wiki.cetechihuahua.gob.mx/index.php/Especial:Random">Página aleatoria</a></li>
										<li id="n-help"><a href="http://wiki.cetechihuahua.gob.mx/index.php/CIST:Ayuda">Ayuda</a></li>
										<li id="n-sitesupport"><a href="http://wiki.cetechihuahua.gob.mx/index.php/CIST:Apoyo_al_proyecto">Donaciones</a></li>
									</ul>
					</li>
								<li><span>Herramientas</span>
					<ul>
					  					  <li id="t-whatlinkshere"><a href="http://wiki.cetechihuahua.gob.mx/index.php?title=Especial:Whatlinkshere&amp;target=ORM-Hibernate_Consultas_basadas_Hiberante">Lo que enlaza aquí</a></li>
					  					  <li id="t-recentchangeslinked"><a href="http://wiki.cetechihuahua.gob.mx/index.php?title=Especial:Recentchangeslinked&amp;target=ORM-Hibernate_Consultas_basadas_Hiberante">Seguimiento de enlaces</a></li>
					  				      				      				      				      				      				      				      <li id="t-upload"><a href="http://wiki.cetechihuahua.gob.mx/index.php/Especial:Upload">Subir archivo</a></li>				      				      <li id="t-specialpages"><a href="http://wiki.cetechihuahua.gob.mx/index.php/Especial:Specialpages">Páginas especiales</a></li>				      					</ul>
				</li>
							</ul>
		</div><!-- end of SIDE div -->
		
		<div id="mainContent">
			
			<h1>ORM-Hibernate Consultas basadas Hiberante</h1>
			<h3 id="siteSub">De CIST</h3>
			<div id="contentSub"></div>
									<!-- start content -->
			<table id="toc" class="toc" summary="Tabla de contenidos"><tbody><tr><td><div id="toctitle"><h2>Tabla de contenidos</h2> <span class="toctoggle">[<a href="javascript:toggleToc()" class="internal" id="togglelink">esconder</a>]</span></div>
<ul>
<li class="toclevel-1"><a href="#Introducci.C3.B3n"><span class="tocnumber">1</span> <span class="toctext">Introducción</span></a>
<ul>
<li class="toclevel-2"><a href="#Consultar_a_un_usuario_y_password"><span class="tocnumber">1.1</span> <span class="toctext">Consultar a un usuario y password</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Consultas_utilizando_HQL"><span class="tocnumber">2</span> <span class="toctext">Consultas utilizando HQL</span></a></li>
<li class="toclevel-1"><a href="#Validar_si_existe_un_ruta_en_la_tabla_acci.C3.B3n"><span class="tocnumber">3</span> <span class="toctext">Validar si existe un ruta en la tabla acción</span></a></li>
</ul>
</td></tr></tbody></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "mostrar"; var tocHideText = "esconder"; showTocToggle(); } </script>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="http://wiki.cetechihuahua.gob.mx/index.php?title=ORM-Hibernate_Consultas_basadas_Hiberante&amp;action=edit&amp;section=1" title="Edit section: Introducción">editar</a>]</div><a name="Introducci.C3.B3n"></a><h2> Introducción </h2>
<p>Existen varias maneras de ejecutar consultas en Hibernate que van 
desde SQL hasta Objetos especializados en Criterios basados en Objetos. 
Es necesario resaltar que dependiendo del caso y del objetivo de la 
consulta, ya que si se requiere generar un reporte por ejemplo, podemos 
utilzar un HQL con campos específicos.
</p><p>Dentro de los mecanismos existen
</p>
<ul><li>Consultas de SQL nativo
</li><li>Consultas de HQL (utilizando un Objeto query)
</li><li>Consultas utilizando Criterios y expresiones.
</li></ul>
<p>Para ejemplificar el uso de consultas en Hibernate se utiliza el siguiente esquema de base de datos:
</p><p><a href="http://wiki.cetechihuahua.gob.mx/index.php/Imagen:ER-UsuariosSeguridad.jpg" class="image" title="Imagen:ER-UsuariosSeguridad.jpg"><img src="ORM-Hibernate%20Consultas%20basadas%20Hiberante%20-%20CIST_files/ER-UsuariosSeguridad.jpg" alt="Imagen:ER-UsuariosSeguridad.jpg" longdesc="/index.php/Imagen:ER-UsuariosSeguridad.jpg" height="341" width="720"></a>
</p><p>En las siguientes Secciones se mostrarán algunos ejemplos utiles y
 de aplicación real en el esquema que se muestra con anterioridad.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="http://wiki.cetechihuahua.gob.mx/index.php?title=ORM-Hibernate_Consultas_basadas_Hiberante&amp;action=edit&amp;section=2" title="Edit section: Consultar a un usuario y password">editar</a>]</div><a name="Consultar_a_un_usuario_y_password"></a><h3> Consultar a un usuario y password </h3>
<p>Una de las formas que podemos utilizar para hacer consultas con 
hibernate es utilizando con el objeto Criteria e cual se obtiene a 
partir de una session y con base a una clase <b>Usuario.class</b>. 
</p>
<pre>public long autenticar(String usuario, String password)
			throws UsuarioInvalidoException {
        Transaccion transaccion = null;
		
		try {
            transaccion = HibernateTransaccionalSimple.crearTransaccionGlobal();
            transaccion.beginSession();
            long idUsuario = 0;
            Criteria criteria = transaccion.getSession().createCriteria(Usuario.class);
            criteria.add(Expression.eq("usuario",usuario));
            criteria.add(Expression.eq("password",password));
            Usuario u = (Usuario)criteria.uniqueResult();   
            if (u&nbsp;!=null ) {
                idUsuario = u.getIdUsuario()&nbsp;;
            } else {
                throw new UsuarioInvalidoException(usuario);
            }       
            return idUsuario;
		} catch (HibernateConexionException e) {
			throw new UsuarioInvalidoException(usuario);
		} finally {
            try {
                transaccion.finishAndClose();
            } catch (HibernateConexionException e) {
                throw new UsuarioInvalidoException(usuario);
            }   
        }
}
</pre>
<p>Como podemos observar el objeto criteria recibe  Expresiones las cuales modifican el criterio de evaluación, como por ejemplo <b>Expression.eq("usuario",usuario)</b> que valida si la propiedad usuario de la clase Usuario es igual que el parámetro usuario.
</p><p>Un factor de importancia es el uso de una consulta utilizando la siguiente expresion:
</p>
<pre>Usuario u = (Usuario)criteria.uniqueResult();
</pre>
<p>Está expresión es utilizada en las ocasiones que el desarrollar sabe 
que el resultado de la consulta es únicamente un registro, de está 
manera hibernate no regresa una Set o un List si no un sólo registro. 
Cabe señalar que al usar el <i>uniqueResult</i> debemos estar completamente seguros de que sólo un registro será procesado, de lo controrio Hibernate lanzará una excepción.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="http://wiki.cetechihuahua.gob.mx/index.php?title=ORM-Hibernate_Consultas_basadas_Hiberante&amp;action=edit&amp;section=3" title="Edit section: Consultas utilizando HQL">editar</a>]</div><a name="Consultas_utilizando_HQL"></a><h2> Consultas utilizando HQL </h2>
<pre>        /**
	 * Obtiene un listado de los roles que no tiene asignado el usuario
	 * @return
	 * @throws ImposibleListarRolesException
	 */
	public Collection getRolesNoAsignados(Usuario usuario) throws ImposibleListarRolesException{
		
	    Collection roles = null;
		
            try {
	      transaccion.begin();
              Query query = transaccion.getSession().createQuery(
                "FROM Rol r " +
		"WHERE r.idRol NOT IN ( SELECT ur.rol.idRol  " +
					"FROM UsuarioRol ur " +
					"  WHERE ur.usuario=&nbsp;:user)");
              query.setEntity("user",usuario);
              roles = query.list();
	      transaccion.close();
	    } catch (Exception e) {
		Debug.excepcion(e);
	    }
	  return roles;
	}
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="http://wiki.cetechihuahua.gob.mx/index.php?title=ORM-Hibernate_Consultas_basadas_Hiberante&amp;action=edit&amp;section=4" title="Edit section: Validar si existe un ruta en la tabla acción">editar</a>]</div><a name="Validar_si_existe_un_ruta_en_la_tabla_acci.C3.B3n"></a><h2> Validar si existe un ruta en la tabla acción </h2>
<pre>/**
     * Busca un registro en la base de datos
     * @param url
     * @return
     */
    private static boolean existeMenu(String url, long idUsuario) {
        List list = null;
        Query query = session.createQuery("FROM Accion a " +
                "WHERE a.idAccion IN ( " +
                "   SELECT p.accion.idAccion FROM Permiso p" +
                "   WHERE p.rol.idRol IN ( " +
                "       SELECT r.idRol FROM Rol r " +
                "       WHERE r.idRol IN (" +
                "           SELECT ur.rol.idRol FROM UsuarioRol ur " +
                "           WHERE ur.usuario.idUsuario=:idUsuario ))) " +
                "AND a.ruta=:ruta ");
        query.setLong("idUsuario",new Long(idUsuario));
        //query.setString("ruta",url);
        list = query.list();            
        if (list.size() &gt; 0 ) {            
            return true;
        }        
        return false;
    }
</pre>

<!-- Saved in parser cache with key wikidb:pcache:idhash:1536-0!1!0!0!!es!2 and timestamp 20150417045849 -->
<div class="printfooter">
Obtenido de "<a href="http://wiki.cetechihuahua.gob.mx/index.php/ORM-Hibernate_Consultas_basadas_Hiberante">http://wiki.cetechihuahua.gob.mx/index.php/ORM-Hibernate_Consultas_basadas_Hiberante</a>"</div>
						<!-- end content -->

		</div><!-- end of MAINCONTENT div -->	
	
	</div><!-- end of MBODY div -->

	<div id="footer"><table><tbody><tr><td align="left" nowrap="nowrap" width="1%">
		<div id="f-copyrightico"><a href="http://www.gnu.org/copyleft/fdl.html"><img src="ORM-Hibernate%20Consultas%20basadas%20Hiberante%20-%20CIST_files/gnu-fdl.png" alt="GNU Free Documentation License 1.2"></a></div></td><td align="center">
		<span id="f-lastmod"> Esta página fue modificada por última vez el 19:39 8 may 2007.</span>		<span id="f-viewcount">Esta página ha sido visitada 2.181 veces. </span>		<ul id="f-list">
						<li id="f-copyright">El contenido está disponible bajo los términos de la <i><a href="http://www.gnu.org/copyleft/fdl.html" class="external " title="http://www.gnu.org/copyleft/fdl.html" rel="nofollow">GNU Free Documentation License 1.2</a></i></li>			<li id="f-about"><a href="http://wiki.cetechihuahua.gob.mx/index.php/CIST:Acerca_de" title="CIST:Acerca de">Acerca de CIST</a></li>			<li id="f-disclaimer"><a href="http://wiki.cetechihuahua.gob.mx/index.php/CIST:Limitaci%C3%B3n_general_de_responsabilidad" title="CIST:Limitación general de responsabilidad">Aviso legal</a></li>		</ul></td><td align="right" nowrap="nowrap" width="1%"><div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="ORM-Hibernate%20Consultas%20basadas%20Hiberante%20-%20CIST_files/poweredby_mediawiki_88x31.png" alt="MediaWiki"></a></div></td></tr></tbody></table>
	</div><!-- end of the FOOTER div -->
</div><!-- end of the CONTAINER div -->

<!-- Served by cerberus.cetechihuahua.gob.mx in 0.139 secs. -->


</body></html>
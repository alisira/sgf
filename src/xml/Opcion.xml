<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="opcion" >
  <resultMap id="Opcion" class="sigefirrhh.persistencia.modelo.Opcion" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Apr 21 15:12:33 VET 2015.
    -->
    <result column="id_opcion" property="idOpcion" jdbcType="INTEGER" />
    <result column="codigo_opcion" property="codigoOpcion" jdbcType="VARCHAR" />
    <result column="descripcion" property="descripcion" jdbcType="VARCHAR" />
    <result column="ruta" property="ruta" jdbcType="VARCHAR" />
    <result column="tipo" property="tipo" jdbcType="VARCHAR" />
    <result column="uri" property="uri" jdbcType="VARCHAR" />
    <result column="jerarquia" property="jerarquia" jdbcType="VARCHAR" />
	<result column="expediente" property="expediente" jdbcType="INTEGER" />	
	<result column="fecha_reg" property="fechaRegistro" jdbcType="DATE" />
	<result column="observacion" property="observacion" jdbcType="VARCHAR" />
	<result column="estatus" property="estatus" jdbcType="VARCHAR" />
	  
  </resultMap>
  
  <select id="buscarOpcion" resultMap="Opcion" parameterClass="sigefirrhh.persistencia.modelo.CriterioBusqueda" >
    <!--realizado el 21-04-15 15:20:44 .-->
		SELECT id_opcion, codigo_opcion, descripcion, ruta, tipo, uri, jerarquia, estatus, 0 as expediente, '' as observacion, '2100-01-01' as fecha_reg
			FROM opcion 
		where 
		jerarquia is not null   
	   		
		<isNotNull prepend="AND" property="uri" >
			<iterate property="uri" open="uri in (" close=")"	conjunction="," >
				#uri[]#
			</iterate>
		</isNotNull>
		
		<isNotNull prepend="AND" property="ruta" >
			<iterate property="ruta" open="ruta in (" close=")"	conjunction="," >
				#ruta[]#
			</iterate>
		</isNotNull>
		
		<isNotNull prepend="AND" property="estatusStr" >
			<iterate property="estatusStr" open="estatus in (" close=")"	conjunction="," >
				#estatusStr[]#
			</iterate>
		</isNotNull>
		
   		 order by jerarquia
  </select> 
  
  
  <select id="buscarOpcionxRol" resultMap="Opcion" parameterClass="sigefirrhh.persistencia.modelo.CriterioBusqueda" >
    <!--realizado el 21-04-15 15:20:44 .-->
	    SELECT op.id_opcion, codigo_opcion, descripcion, ruta, tipo, uri, jerarquia, '' as expediente
			FROM  public.rol, public.opcion op, public.rolopcion
			WHERE 
			  op.id_opcion = rolopcion.id_opcion AND
			  rolopcion.id_rol = rol.id_rol and
			  op.jerarquia is not null 
    
	   <isParameterPresent >
	  
			<isNotNull prepend="AND" property="idRol" >
				<iterate property="idRol" open="rol.id_rol in (" close=")"	conjunction="," >
					#idRol[]#
				</iterate>
			</isNotNull>
			
			<isNotNull prepend="AND" property="uri" >
				<iterate property="uri" open="uri in (" close=")"	conjunction="," >
					#uri[]#
				</iterate>
			</isNotNull>
		
		</isParameterPresent>
   		 order by op.jerarquia
  	</select>
  
	<select id="buscarOpcionExpediente" resultMap="Opcion" parameterClass="sigefirrhh.persistencia.modelo.CriterioBusqueda" >
	  	SELECT
	  		 o.id_opcion, codigo_opcion, descripcion, ruta, tipo, uri, jerarquia, o.estatus,
			o.descripcion,   e.ano,   e.estatus, e.expediente, e.observacion, e.fecha_reg
		FROM expediente e,  opcion o
		WHERE 
			e.id_opcion = o.id_opcion
		
			<isNotNull prepend="AND" property="uri" >
				<iterate property="uri" open="o.uri in (" close=")" conjunction="," >
					#uri[]#
				</iterate>
			</isNotNull>
			
			<isNotNull prepend="AND" property="ano" >
				<iterate property="ano" open="e.ano in (" close=")" conjunction="," >
					#ano[]#
				</iterate>
			</isNotNull>			
			
			<resultMaps>
  <resultMap id="select-product-result" class="product">
    <result property="id" column="PRD_ID"/>
    <result property="description" column="PRD_DESCRIPTION"/>
    <result property="category" resultMapping="Category.CategoryResult" />
  </resultMap>
</resultMaps>

<statements>
  <statement id="selectProduct" parameterClass="int" resultMap="select-product-result">
    select *
    from PRODUCT, CATEGORY
    where PRD_CAT_ID=CAT_ID
    and PRD_ID = #value#
  </statement>
</statements>
			
			<isNotNull prepend="AND" property="expediente" >
				<iterate property="expediente" open="e.expediente in (" close=")"	conjunction="," >
					#expediente[]#
				</iterate>
			</isNotNull>
						
			<isNotNull prepend="AND" property="estatusStr" >
				<iterate property="estatusStr" open="o.estatus in (" close=")"	conjunction="," >
					#estatusStr[]#
				</iterate>
			</isNotNull>

			<isNotNull prepend="AND" property="estatus" >
				<iterate property="estatus" open="e.estatus in (" close=")"	conjunction="," >
					#estatus[]#
				</iterate>
			</isNotNull>
	
		ORDER BY o.descripcion, e.ano
   </select>
   
</sqlMap>